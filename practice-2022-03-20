<mxfile host="app.diagrams.net" modified="2022-03-22T14:25:23.050Z" agent="5.0 (Windows)" etag="ikm9DY16eENWQ4u1OB1U" version="17.1.3" type="github" pages="4">
  <diagram id="uW7OsOjydMDewvjMiIQj" name="newsfeed">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-1" value="&lt;div&gt;news feed: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;req:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user write own feed&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user make friends&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user read friends feed&lt;/div&gt;&lt;div&gt;non req:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;avail &amp;gt; consistrency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;latency low&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durabilty&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/timeline? user_id -&amp;gt; [ posts ]&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/posts? . &amp;nbsp;&amp;nbsp; BODY: post payload {title, content}, userId -&amp;gt; /posts/post_id &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; GET api/v1/posts/p_id   --&amp;gt;  post&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;PUT api/v1/posts?&amp;nbsp; BODY: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/friend. BODY: user1, user2 (identical) -&amp;gt; response: OK 200 &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/posts? sort=+time, -time, +relevance, +locality, -&amp;gt; [ posts ]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;data model:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;resources: user, posts&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;relations: u-u(m-m), u-p(1-many)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&amp;nbsp;timeline: see as an aggregation action. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;schema:&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user:&amp;nbsp; userID, name, identity, etc... &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;posts: pID(pk), userID (idx), title, content&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;friend: user1, user2, ts, status &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mvp:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user: crud svc + store&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;friend:&amp;nbsp; user -&amp;gt; f_svc -&amp;gt; friend_db&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;post: user -&amp;gt; postsvc -&amp;gt; post_db&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;timeline: user-&amp;gt; timelinesvc -&amp;gt;get friends -&amp;gt; get posts -&amp;gt; aggregate into timeline&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="20" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-27" target="9f2MgLWmkAvwQ-DP_VtF-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-13" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="50" y="700" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-17" value="1. get friends" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-14" target="9f2MgLWmkAvwQ-DP_VtF-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-19" value="3. get opsts for all f" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-14" target="9f2MgLWmkAvwQ-DP_VtF-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-25" value="5 return" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-14" target="9f2MgLWmkAvwQ-DP_VtF-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-14" value="timeline" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="185" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-18" value="2. return" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-16" target="9f2MgLWmkAvwQ-DP_VtF-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-16" value="friends" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="560" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-22" value="4. merge all posts, do ranking" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-20" target="9f2MgLWmkAvwQ-DP_VtF-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-20" value="post store" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="420" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-27" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="680" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-13" target="9f2MgLWmkAvwQ-DP_VtF-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="80" y="730" as="sourcePoint" />
            <mxPoint x="185" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-29" value="&lt;div&gt;deepdive: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. timelline svc:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; bottleneck:  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. read amplification: 1timeline -&amp;gt; multi users -&amp;gt; multi * multi posts -&amp;gt;  high pressure to backend, esp mysql &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. too much calculation onto timeline svc: 1 req -&amp;gt; 1 rank cal  to hundreds of tposts -&amp;gt; big pressure to timelien svc. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;solution:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. add cache that buffer the timeline for each user, save mysql read, save calculation. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;improve:&lt;/span&gt;&lt;/div&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;pre-calculation, pre-cache" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="50" y="1010" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-52" target="9f2MgLWmkAvwQ-DP_VtF-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-58" value="write post" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-43" target="9f2MgLWmkAvwQ-DP_VtF-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-43" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="80" y="1370" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-46" value="5 return" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-47" target="9f2MgLWmkAvwQ-DP_VtF-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-47" target="9f2MgLWmkAvwQ-DP_VtF-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-64" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-47" target="9f2MgLWmkAvwQ-DP_VtF-65" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="270" y="1520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-47" value="timeline" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="215" y="1370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-52" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="1350" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-43" target="9f2MgLWmkAvwQ-DP_VtF-52" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="110" y="1400" as="sourcePoint" />
            <mxPoint x="215" y="1400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-56" value="return {userID: timeline}" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.942;entryY=0.933;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-54" target="9f2MgLWmkAvwQ-DP_VtF-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-54" value="timeline store" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="890" y="1350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-61" value="write to differnet users&#39; space Asyncly" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-57" target="9f2MgLWmkAvwQ-DP_VtF-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-57" value="&lt;div&gt;postsvc&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="1240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-73" value="async update" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-60" target="9f2MgLWmkAvwQ-DP_VtF-71" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="770" y="1115" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-60" value="friendsvc" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="707" y="1160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-63" value="&lt;div&gt;pre-cal solutiON:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;deepdive: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;timeline:&lt;/div&gt;&lt;blockquote&gt;&lt;blockquote&gt;&lt;div&gt;qps: 1M: , stateless svc, 3k req -&amp;gt; 300hosts , &lt;br&gt;&lt;/div&gt;&lt;div&gt;zk to maintain the hosts, k-oche serice, &lt;br&gt;&lt;/div&gt;&lt;div&gt;read from the timeline store.&amp;nbsp; what in timeline store?&amp;nbsp; later&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;timelien get [ids] from tl store:&amp;nbsp; need to get post from p_store.&amp;nbsp; Cache: redis , LRU, cache the posts.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;div&gt;tl store: schema: userID | timeline&amp;nbsp;&amp;nbsp; , kv &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;qps: 1M read,&amp;nbsp; 100M*0.1/1e5 -&amp;gt; 100 qps, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;in memory store:&amp;nbsp; redis: (redis provide sort funcion: zset , when store opst, [ p_id, ts] --&amp;gt; sorted by redis &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; [ sorted posts from friends by time]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;what if tlstore fail?&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;replica, in-sync&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;periodic flush to disk, pickup when restarted. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;what if data too big? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;redis cluster, sharding by u_id. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;postSvc: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;async&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;consumer&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;cache friend&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;easy to scale&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;fault: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;postsvc stateless, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;mq:&amp;nbsp; make sure it won&#39;t lose msg,&amp;nbsp;&amp;nbsp; ack,&amp;nbsp; at least 1, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;waht if mq fails?&amp;nbsp; mq fail rate low, if fail, db store the last time udpate position. &amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;what if mq dup deliver?&amp;nbsp; depends on biz requirements, maybe we need dedup process ?&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;what if multi dc? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;local read/write. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2 options: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sync all data&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;not sync, but do cross-colo call. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;what issue do we have? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;async process too long, not good for celebrity users.&amp;nbsp; take days to get celibraty udates. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;solution:&amp;nbsp;&amp;nbsp; catagoirze celebrity &#39;s identity,&amp;nbsp;&amp;nbsp; use pull when necessary, merge with push solution. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="1650" width="690" height="10" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-65" value="&lt;div&gt;redis to cache posts&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="1490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-66" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="1240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-69" target="9f2MgLWmkAvwQ-DP_VtF-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-69" target="9f2MgLWmkAvwQ-DP_VtF-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-69" value="consumer, stateless, easy scale up. " style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="890" y="1230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-71" value="redis friends cache" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="940" y="1100" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-74" value="postdb" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="1240" width="50" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ng51k9mVHl7mOArd_uNx" name="roblox favorite">
    <mxGraphModel dx="1865" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="yrexTqZfdFiRCdiGLR_K-0" />
        <mxCell id="yrexTqZfdFiRCdiGLR_K-1" parent="yrexTqZfdFiRCdiGLR_K-0" />
        <mxCell id="xf6ZnegDZT0TrVwEhlzp-1" value="# Your previous Plain Text content is preserved below:&lt;br&gt;# &lt;br&gt;# &lt;br&gt;# Roblox has a marketplace with millions of items for sale. For each item, users can choose to flag it as a favorite (similar to Like or Bookmark). An item which is flagged can be un-flagged.&lt;br&gt;# Design a system which is able to show the number of favorites each item has.&lt;br&gt;# &amp;nbsp;&lt;br&gt;# User Stories:&lt;br&gt;# - As a user, I want to know if this item is flagged as a favorite for me (1M qps)&amp;nbsp; read&lt;br&gt;# - As a user, I want to flag/unflag this item as a favorite (100k qps)&amp;nbsp; write &amp;nbsp;&lt;br&gt;# - As a user, I want to see the count of all users who had flagged this as a favorite (1M qps)&amp;nbsp; read , item based, no user based. " style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="20" y="20" width="690" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xf6ZnegDZT0TrVwEhlzp-2" value="&lt;div&gt;req:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;user like/unlike item&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;user know if it is liked by me&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;user see count of all likes&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;non-tech req:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;consistency &amp;lt; availa&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;data durability : not high&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;latency : low&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;data flow:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; user -&amp;gt; click 1 item -&amp;gt; see item like count&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;-&amp;gt; click like on item -&amp;gt; like cnt += 1&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;-&amp;gt; click unlikc on item -&amp;gt; like cnt -= 1&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;-&amp;gt; see if i&#39;ve liked it. &lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;see item&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;GET api/v1/items/id , --&amp;gt; item&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;see count:&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;GET api/v1/items/id/like, --&amp;gt; int &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;click like:&lt;br&gt;POST api/v1/item / id/ likes , HEADER : {cookie : user toek} , BODY{type: up or down } -&amp;gt; 200&amp;nbsp; response boody { total_vote:&amp;nbsp; }&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="30" y="200" width="680" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-0" target="Vm4RPs8cP-7FOJJW0_Dn-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-0" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="80" y="670" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-1" target="Vm4RPs8cP-7FOJJW0_Dn-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-1" value="like service" style="whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="210" y="670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-3" value="like store" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="460" y="670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-5" value="&lt;div&gt;schema:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;p_id(idx) | u_id(idx) | status (like or not) | ts&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="630" y="670" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-6" value="&lt;div&gt;see count:&amp;nbsp;&amp;nbsp;1 p+_id, do COUNT()&amp;nbsp;&amp;nbsp; -&amp;gt; slow , 1M qps&lt;br&gt;&lt;/div&gt;&lt;div&gt;click like:&amp;nbsp; p_id + u_id -&amp;gt; ts , tru false 100k qps,&lt;br&gt;&lt;/div&gt;&lt;div&gt;see if I liked: p_id + u_id ,&amp;nbsp; qps 1M &lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="80" y="780" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-7" value="&lt;div&gt;bottleneck:&lt;/div&gt;&lt;div&gt;1. mysql&amp;nbsp; cant bear so much traffic:&amp;nbsp;&amp;nbsp; read, write .&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;read -&amp;gt; cache,&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;write -&amp;gt; mq to buffer, batch sevice to batch, lower pressure. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="80" y="870" width="610" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-9" target="Vm4RPs8cP-7FOJJW0_Dn-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-9" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="50" y="1415" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-11" target="Vm4RPs8cP-7FOJJW0_Dn-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-11" value="like consuer" style="whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="280" y="1040" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-12" value="like db" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="460" y="1040" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-13" value="&lt;span style=&quot;&quot;&gt;	&lt;/span&gt;write -&amp;gt; mq to buffer, batch sevice to batch, lower pressure." style="text;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="50" y="990" width="330" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-14" target="Vm4RPs8cP-7FOJJW0_Dn-19">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="260" y="1085" />
              <mxPoint x="260" y="1210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-14" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="140" y="1040" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-15" value="&lt;div&gt;smooth processing, &lt;br&gt;&lt;/div&gt;&lt;div&gt;consumer easy to scale&lt;/div&gt;&lt;div&gt;mq shift load&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="600" y="960" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-17" value="&lt;div&gt;large amount of data, large aount of traffic:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;partition the db (consisten hashing), vitess for mysql, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if read is too much: replica to seperate wrie and read here. &lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="610" y="1040" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-18" value="&lt;div&gt;bottle2: fetch count, but it is scanning the whole talbe: &lt;br&gt;&lt;/div&gt;&lt;div&gt;relaxing the concsitency, denormalize: &lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="-105" y="1195" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-19" value="post like db&lt;br&gt;[pid | count]" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="460" y="1170" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-21" value="batch update" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="280" y="1190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-22" value="store 1 sec data, merge by p_id, write to db" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="285" y="1260" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-23" value="lower db pressure, lower write frequency" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="380" y="1320" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-24" value="read" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="-100" y="1430" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-25" target="Vm4RPs8cP-7FOJJW0_Dn-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-25" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="90" y="1050" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-31" target="Vm4RPs8cP-7FOJJW0_Dn-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-31" value="like cnt service" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="280" y="1410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-32" value="redis" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="325" y="1510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-34" value="&lt;div&gt;cache aside, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;relative short ttl.&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="440" y="1540" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-37" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-35" target="Vm4RPs8cP-7FOJJW0_Dn-36">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-35" value="full in-memoery db to hold all the data" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="560" y="1475" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-36" value="&lt;div&gt;fault tolerance: &lt;br&gt;&lt;/div&gt;&lt;div&gt;hot standby, &lt;br&gt;&lt;/div&gt;&lt;div&gt;persistence, to file, to db&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="760" y="1455" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-38" target="Vm4RPs8cP-7FOJJW0_Dn-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-38" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="50" y="1580" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-39" value="read if I like" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="-100" y="1595" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.018;entryY=0.325;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-40" target="Vm4RPs8cP-7FOJJW0_Dn-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-40" target="Vm4RPs8cP-7FOJJW0_Dn-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-40" value="like svc" style="whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="280" y="1580" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-43" value="cache" style="whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="354" y="1694" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.129;entryY=0.019;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-45" target="Vm4RPs8cP-7FOJJW0_Dn-31">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-45" target="Vm4RPs8cP-7FOJJW0_Dn-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-45" value="read a post svc" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="40" y="1260" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-48" value="&lt;div&gt;improve: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;like cnt service&lt;br&gt;&lt;/div&gt;&amp;nbsp;- inconcnistenc,&amp;nbsp; not accurate. " style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="-70" y="1790" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" edge="1" source="Vm4RPs8cP-7FOJJW0_Dn-53" target="Vm4RPs8cP-7FOJJW0_Dn-59" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-53" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="120" y="2265" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" source="Vm4RPs8cP-7FOJJW0_Dn-55" target="Vm4RPs8cP-7FOJJW0_Dn-56" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-55" target="Vm4RPs8cP-7FOJJW0_Dn-78">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-55" value="like consuer" style="whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="350" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-72" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-56" target="Vm4RPs8cP-7FOJJW0_Dn-73">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="770" y="2030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-56" value="like db" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="530" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" source="Vm4RPs8cP-7FOJJW0_Dn-58" target="Vm4RPs8cP-7FOJJW0_Dn-59" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="330" y="1935" />
              <mxPoint x="330" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-58" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="210" y="1890" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-59" value="post like db&lt;br&gt;[pid | count]" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="530" y="2020" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-60" value="batch update" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="350" y="2040" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-61" value="store 1 sec data, merge by p_id, write to db" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="355" y="2110" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-62" value="lower db pressure, lower write frequency" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="450" y="2170" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-63" value="read" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="-30" y="2280" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" source="Vm4RPs8cP-7FOJJW0_Dn-65" target="Vm4RPs8cP-7FOJJW0_Dn-55" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-65" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="160" y="1900" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-66" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" source="Vm4RPs8cP-7FOJJW0_Dn-67" parent="yrexTqZfdFiRCdiGLR_K-1" target="Vm4RPs8cP-7FOJJW0_Dn-77">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="455" y="2360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.4;entryY=0.975;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-67" target="Vm4RPs8cP-7FOJJW0_Dn-75">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-67" value="like cnt service" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="350" y="2260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-70" value="today&#39;s real time data" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="500" y="1990" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-73" value="daily snapshort" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="750" y="2020" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-74" value="daily snapshort" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="760" y="2030" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-75" value="daily snapshort" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="770" y="2040" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-77" value="cache" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="460" y="2360" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-78" target="Vm4RPs8cP-7FOJJW0_Dn-73">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-78" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" vertex="1" parent="yrexTqZfdFiRCdiGLR_K-1">
          <mxGeometry x="590" y="1790" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="AZ77vJw2ojLxVnteHUjz" name="upstart signup page">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-0" />
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-1" parent="6J5aaT0vLCsX0WpH28Cg-0" />
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-14" value="&lt;div&gt;sign&amp;nbsp; on system&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;func req&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sign on: name/pswd,&amp;nbsp; oauth?&amp;nbsp; ,,&amp;nbsp; guest?&amp;nbsp; sso?&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;non-func:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;availability &amp;gt; consistency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;security&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;user flow:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; sign up -&amp;gt; provide: name, pswd, email, phone&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;-&amp;gt; auth code to email and phone, or an auth link to email and phone, need to click within 30min&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;-&amp;gt; auth succeed. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; login page -&amp;gt; choose method to login:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;u/pswd&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;oauth: google, fb, linkedin&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;login as guest&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; 1st page -&amp;gt; do things&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; another page -&amp;gt; no need to login again&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; 3rd page ...&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; log out on 3rd page&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; 1st page -&amp;gt; need to login again. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;HTTPS:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/user/signup, body: {uname, pswd, email, phone } --&amp;gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;good: 301 redirect to real page, notice to click the lnk inside (email, phone, app) , set_cookie&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;bad: err 4xx, show error cause. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/user/login, body: {uname, pswd} --&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;good: return cookie.&amp;nbsp; 200OK, or 301 redirect&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;bad: return 4xxx, error&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; POST api/v1/signout ，{uname, token} --&amp;gt; ok or fail &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/otherpath, {uname, token } --&amp;gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;401 unAuth, 403 forbidden, 500 error&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="40" y="50" width="510" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-16" value="1. signup" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-15" target="6J5aaT0vLCsX0WpH28Cg-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-15" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="90" y="760" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-17" target="6J5aaT0vLCsX0WpH28Cg-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="470" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-17" target="6J5aaT0vLCsX0WpH28Cg-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-17" value="signup svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="260" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-22" value="user store" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="470" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-23" value="login method store" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="470" y="820" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-27" value="&lt;div&gt;name/pswd table&lt;/div&gt;&lt;div&gt;google oauth table&lt;/div&gt;&lt;div&gt;fb oatuth table&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="610" y="835" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-28" value="2. sign in" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-29" target="6J5aaT0vLCsX0WpH28Cg-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-37" value="4. take cookie (token)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-29" target="6J5aaT0vLCsX0WpH28Cg-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="260" y="1030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-29" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="90" y="890" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-36" value="3. return cookie" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="140" y="935" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-30" value="signup svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="260" y="890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-40" value="5.2 check w/ signup svc" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-38" target="6J5aaT0vLCsX0WpH28Cg-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-38" value="other system" style="whiteSpace=wrap;html=1;aspect=fixed;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="240" y="1040" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-39" value="5.1 self auth" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-38" target="6J5aaT0vLCsX0WpH28Cg-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="400" y="1060" />
              <mxPoint x="400" y="1100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-41" value="&lt;div&gt;user store:&amp;nbsp;&amp;nbsp; uid | real - name | address .... profiles. &lt;br&gt;&lt;/div&gt;&lt;div&gt;login_method_store:&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;name_pswd table:&amp;nbsp; uid | name | pswd &amp;nbsp; ( no real pswd, hashed, salted, slow hashed )&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;oauth table: uid | provider_name | oauth_id | access token | expires | refresh_token&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;api table: uid | api_key | api_secret&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="40" y="1160" width="740" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-42" value="Text" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="200" y="1140" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-43" value="&lt;div&gt;how cookie token is generated: &lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="30" y="1300" width="380" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-44" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="70" y="1390" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-45" value="login svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="220" y="1390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-46" value="oauth provider" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="460" y="1390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-52" value="I want to login via oauth" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1530" as="sourcePoint" />
            <mxPoint x="260" y="1530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-53" value="redirect to oauth" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="1600" as="sourcePoint" />
            <mxPoint x="90" y="1600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-55" value="login on oauth" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1630" as="sourcePoint" />
            <mxPoint x="520" y="1630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-56" value="redirect to login svc with a code" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="1710" as="sourcePoint" />
            <mxPoint x="90" y="1710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-65" value="oauth authen, create a pair:&amp;nbsp; code : access code : u_id" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="540" y="1620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-67" value="login again with code" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1770" as="sourcePoint" />
            <mxPoint x="260" y="1770" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-68" value="check w/ oauth the code, get access code, get info" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="1800" as="sourcePoint" />
            <mxPoint x="560" y="1800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-69" value="return good, access code" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="1850" as="sourcePoint" />
            <mxPoint x="290" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-70" value="create a token/session for this user" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="230" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-71" value="return token/session id in cookie" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="2010" as="sourcePoint" />
            <mxPoint x="105" y="2010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-72" value="sso to other pages" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="2060" as="sourcePoint" />
            <mxPoint x="280" y="2060" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-73" value="&lt;div&gt;jwt token:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;单向函数防伪造&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;加salt&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="100" y="2130" width="520" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-74" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="120" y="2260" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-75" value="login" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="550" y="2260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-76" value="uname pswd" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="2300" as="sourcePoint" />
            <mxPoint x="530" y="2300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-77" value="return token/session id in cookie" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="2470" as="sourcePoint" />
            <mxPoint x="160" y="2470" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-78" value="&lt;div&gt;1. md5(pswd + salt), auth&lt;/div&gt;&lt;div&gt;2. create a jwt token: &lt;br&gt;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;uname, &lt;br&gt;&lt;/div&gt;&lt;div&gt;expiry,&lt;/div&gt;&lt;div&gt;md5(uname+expiery+pswd)&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="620" y="2338" width="190" height="132" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-79" value="login again, with token" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160" y="2550" as="sourcePoint" />
            <mxPoint x="520" y="2550" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-80" value="&lt;div&gt;1. get uname, expiery, hash&lt;/div&gt;&lt;div&gt;2. check expiery, &lt;br&gt;&lt;/div&gt;&lt;div&gt;3. recalc jwt token, compare with hash. &lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="550" y="2570" width="190" height="132" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="48x7h1dFR0f9NhL7fWYP" name="Page-4">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-0" />
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-1" parent="_ABCVf9kDW8Ui17VEOTW-0" />
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-2" value="&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Go game, web based. &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;1: 1&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;10K games at the same time. &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;Functional requirement: &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;i. Matching same lvl players&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ii. Real time games&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iii. Web-based front end. &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iv. Customized matching player&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;Un functional requirement:&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;i. Real time experience&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ii. Consistent b/w parties&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iii. High available&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iv. Scale ?&amp;nbsp; Is it really necessary? &lt;br&gt;Isolation. " style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="50" y="30" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-3" value="&lt;div&gt;func req:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;1. user find a match&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;2. user place chess, user read opponent step, user step is timed&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;3. user win or oppo win&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;4. user has scores, leaderboard&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;5. user see replay&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;6. user broke and can re-link&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;non fun:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;consistency &amp;gt; availability&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;connection is iimportant, need t recvei data from server&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;data durability : not very import&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;place chess:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;POST api/v1/positions?&amp;nbsp; header: {user token}, body { + positions} -&amp;gt; 200OK {}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;poll opponents chess:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;GET api/v1/positions?&amp;nbsp; --&amp;gt; 200 response , body { + positions,&amp;nbsp; users: oopponnetns}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;poll game status&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;GET api/v1/status? --&amp;gt; 200 response, body {status: CONTINUE, SUCCEED, FAIL, your total score: xx}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="40" y="330" width="710" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-8" value="1. send pos1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" edge="1" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-4" target="_ABCVf9kDW8Ui17VEOTW-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-4" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="110" y="740" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-9" value="&lt;div&gt;4.1 if not finish, write to actor 2&lt;/div&gt;&lt;div&gt;4.2 if finish, write result to actor 2&lt;br&gt;&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-5" target="_ABCVf9kDW8Ui17VEOTW-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-5" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="90" y="1010" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-7" target="_ABCVf9kDW8Ui17VEOTW-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.014;entryY=0.15;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-7" target="_ABCVf9kDW8Ui17VEOTW-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-7" value="go server" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="390" y="860" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-10" value="status of games" style="ellipse;whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="630" y="860" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-12" value="&lt;div&gt;2. write pos1 to the game&lt;/div&gt;&lt;div&gt;3. judge the status of the game&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="390" y="810" width="246" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-13" value="&lt;div&gt;mysql&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;game_id | serialized_game | next player | last updated time | created ts | status | p1 | p2 &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pk: game_id&lt;/div&gt;&lt;div&gt;idx: game_id, p1, p2, last updated time, status&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="650" y="930" width="600" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-14" value="&lt;div&gt;communication: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;push service to notify players: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;oppo has a new move, the game has a new status&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;websocket,&amp;nbsp; duplex , send notification:&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;notification: you have a new msg, you can poll it.&amp;nbsp; -&amp;gt;&amp;nbsp; call Poll new status: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;(rarely) send bakck the real data:&amp;nbsp;&amp;nbsp; ws get apixxxx to get new status. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;long polling:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;http1 ,&amp;nbsp; it is old but still can work.&amp;nbsp;&amp;nbsp;&amp;nbsp; take more internal resources.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;good:&amp;nbsp; easy to impl. ws &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="30" y="1100" width="910" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-15" target="_ABCVf9kDW8Ui17VEOTW-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=35;exitDy=60;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-15" target="_ABCVf9kDW8Ui17VEOTW-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-15" value="push service" style="shape=callout;whiteSpace=wrap;html=1;perimeter=calloutPerimeter;" vertex="1" parent="_ABCVf9kDW8Ui17VEOTW-1">
          <mxGeometry x="130" y="880" width="70" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
