<mxfile host="app.diagrams.net" modified="2022-04-08T17:40:09.160Z" agent="5.0 (Windows)" etag="XiqduGGEOCwbBCTCWCqu" version="17.4.1" type="github" pages="15">
  <diagram id="uW7OsOjydMDewvjMiIQj" name="newsfeed">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-1" value="&lt;div&gt;news feed: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;req:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user write own feed&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user make friends&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user read friends feed&lt;/div&gt;&lt;div&gt;non req:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;avail &amp;gt; consistrency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;latency low&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durabilty&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/timeline? user_id -&amp;gt; [ posts ]&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/posts? . &amp;nbsp;&amp;nbsp; BODY: post payload {title, content}, userId -&amp;gt; /posts/post_id &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; GET api/v1/posts/p_id   --&amp;gt;  post&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;PUT api/v1/posts?&amp;nbsp; BODY: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/friend. BODY: user1, user2 (identical) -&amp;gt; response: OK 200 &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/posts? sort=+time, -time, +relevance, +locality, -&amp;gt; [ posts ]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;data model:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;resources: user, posts&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;relations: u-u(m-m), u-p(1-many)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&amp;nbsp;timeline: see as an aggregation action. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;schema:&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user:&amp;nbsp; userID, name, identity, etc... &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;posts: pID(pk), userID (idx), title, content&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;friend: user1, user2, ts, status &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;mvp:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user: crud svc + store&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;friend:&amp;nbsp; user -&amp;gt; f_svc -&amp;gt; friend_db&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;post: user -&amp;gt; postsvc -&amp;gt; post_db&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;timeline: user-&amp;gt; timelinesvc -&amp;gt;get friends -&amp;gt; get posts -&amp;gt; aggregate into timeline&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="20" width="560" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-27" target="9f2MgLWmkAvwQ-DP_VtF-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-13" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="50" y="700" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-17" value="1. get friends" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-14" target="9f2MgLWmkAvwQ-DP_VtF-16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-19" value="3. get opsts for all f" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-14" target="9f2MgLWmkAvwQ-DP_VtF-20" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-25" value="5 return" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-14" target="9f2MgLWmkAvwQ-DP_VtF-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-14" value="timeline" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="185" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-18" value="2. return" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-16" target="9f2MgLWmkAvwQ-DP_VtF-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-16" value="friends" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="560" y="700" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-22" value="4. merge all posts, do ranking" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-20" target="9f2MgLWmkAvwQ-DP_VtF-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-20" value="post store" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="420" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-27" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="100" y="680" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-13" target="9f2MgLWmkAvwQ-DP_VtF-27" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="80" y="730" as="sourcePoint" />
            <mxPoint x="185" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-29" value="&lt;div&gt;deepdive: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;1. timelline svc:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; bottleneck:  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. read amplification: 1timeline -&amp;gt; multi users -&amp;gt; multi * multi posts -&amp;gt;  high pressure to backend, esp mysql &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. too much calculation onto timeline svc: 1 req -&amp;gt; 1 rank cal  to hundreds of tposts -&amp;gt; big pressure to timelien svc. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;solution:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. add cache that buffer the timeline for each user, save mysql read, save calculation. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;improve:&lt;/span&gt;&lt;/div&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;pre-calculation, pre-cache" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="50" y="1010" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-42" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-52" target="9f2MgLWmkAvwQ-DP_VtF-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-58" value="write post" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-43" target="9f2MgLWmkAvwQ-DP_VtF-57" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-43" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="80" y="1370" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-46" value="5 return" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-47" target="9f2MgLWmkAvwQ-DP_VtF-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-55" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-47" target="9f2MgLWmkAvwQ-DP_VtF-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-64" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-47" target="9f2MgLWmkAvwQ-DP_VtF-65" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="270" y="1520" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-47" value="timeline" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="215" y="1370" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-52" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="130" y="1350" width="60" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-53" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=none;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-43" target="9f2MgLWmkAvwQ-DP_VtF-52" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="110" y="1400" as="sourcePoint" />
            <mxPoint x="215" y="1400" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-56" value="return {userID: timeline}" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=0.942;entryY=0.933;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-54" target="9f2MgLWmkAvwQ-DP_VtF-47" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-54" value="timeline store" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="890" y="1350" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-61" value="write to differnet users&#39; space Asyncly" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-57" target="9f2MgLWmkAvwQ-DP_VtF-54" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-57" value="&lt;div&gt;postsvc&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="1240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-73" value="async update" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-60" target="9f2MgLWmkAvwQ-DP_VtF-71" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="770" y="1115" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-60" value="friendsvc" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="707" y="1160" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-63" value="&lt;div&gt;pre-cal solutiON:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;deepdive: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;timeline:&lt;/div&gt;&lt;blockquote&gt;&lt;blockquote&gt;&lt;div&gt;qps: 1M: , stateless svc, 3k req -&amp;gt; 300hosts , &lt;br&gt;&lt;/div&gt;&lt;div&gt;zk to maintain the hosts, k-oche serice, &lt;br&gt;&lt;/div&gt;&lt;div&gt;read from the timeline store.&amp;nbsp; what in timeline store?&amp;nbsp; later&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;timelien get [ids] from tl store:&amp;nbsp; need to get post from p_store.&amp;nbsp; Cache: redis , LRU, cache the posts.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;blockquote&gt;&lt;div&gt;tl store: schema: userID | timeline&amp;nbsp;&amp;nbsp; , kv &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;qps: 1M read,&amp;nbsp; 100M*0.1/1e5 -&amp;gt; 100 qps, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;in memory store:&amp;nbsp; redis: (redis provide sort funcion: zset , when store opst, [ p_id, ts] --&amp;gt; sorted by redis &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; [ sorted posts from friends by time]&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;what if tlstore fail?&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;replica, in-sync&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;periodic flush to disk, pickup when restarted. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;what if data too big? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;redis cluster, sharding by u_id. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;postSvc: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;async&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;consumer&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;cache friend&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;easy to scale&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;fault: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;postsvc stateless, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;mq:&amp;nbsp; make sure it won&#39;t lose msg,&amp;nbsp;&amp;nbsp; ack,&amp;nbsp; at least 1, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;waht if mq fails?&amp;nbsp; mq fail rate low, if fail, db store the last time udpate position. &amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;what if mq dup deliver?&amp;nbsp; depends on biz requirements, maybe we need dedup process ?&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;what if multi dc? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;local read/write. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2 options: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sync all data&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;not sync, but do cross-colo call. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;what issue do we have? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;async process too long, not good for celebrity users.&amp;nbsp; take days to get celibraty udates. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;solution:&amp;nbsp;&amp;nbsp; catagoirze celebrity &#39;s identity,&amp;nbsp;&amp;nbsp; use pull when necessary, merge with push solution. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="1650" width="690" height="10" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-65" value="&lt;div&gt;redis to cache posts&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="1490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-66" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="1240" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-70" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-69" target="9f2MgLWmkAvwQ-DP_VtF-60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-72" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="9f2MgLWmkAvwQ-DP_VtF-69" target="9f2MgLWmkAvwQ-DP_VtF-71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-69" value="consumer, stateless, easy scale up. " style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="890" y="1230" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-71" value="redis friends cache" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="940" y="1100" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="9f2MgLWmkAvwQ-DP_VtF-74" value="postdb" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="340" y="1240" width="50" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ng51k9mVHl7mOArd_uNx" name="roblox favorite">
    <mxGraphModel dx="1865" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="yrexTqZfdFiRCdiGLR_K-0" />
        <mxCell id="yrexTqZfdFiRCdiGLR_K-1" parent="yrexTqZfdFiRCdiGLR_K-0" />
        <mxCell id="xf6ZnegDZT0TrVwEhlzp-1" value="# Your previous Plain Text content is preserved below:&lt;br&gt;# &lt;br&gt;# &lt;br&gt;# Roblox has a marketplace with millions of items for sale. For each item, users can choose to flag it as a favorite (similar to Like or Bookmark). An item which is flagged can be un-flagged.&lt;br&gt;# Design a system which is able to show the number of favorites each item has.&lt;br&gt;# &amp;nbsp;&lt;br&gt;# User Stories:&lt;br&gt;# - As a user, I want to know if this item is flagged as a favorite for me (1M qps)&amp;nbsp; read&lt;br&gt;# - As a user, I want to flag/unflag this item as a favorite (100k qps)&amp;nbsp; write &amp;nbsp;&lt;br&gt;# - As a user, I want to see the count of all users who had flagged this as a favorite (1M qps)&amp;nbsp; read , item based, no user based. " style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="20" y="20" width="690" height="30" as="geometry" />
        </mxCell>
        <mxCell id="xf6ZnegDZT0TrVwEhlzp-2" value="&lt;div&gt;req:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;user like/unlike item&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;user know if it is liked by me&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;user see count of all likes&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;non-tech req:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;consistency &amp;lt; availa&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;data durability : not high&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;latency : low&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;data flow:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; user -&amp;gt; click 1 item -&amp;gt; see item like count&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;-&amp;gt; click like on item -&amp;gt; like cnt += 1&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;-&amp;gt; click unlikc on item -&amp;gt; like cnt -= 1&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;&lt;span&gt; &lt;/span&gt;-&amp;gt; see if i&#39;ve liked it. &lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;see item&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;GET api/v1/items/id , --&amp;gt; item&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;see count:&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;GET api/v1/items/id/like, --&amp;gt; int &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;click like:&lt;br&gt;POST api/v1/item / id/ likes , HEADER : {cookie : user toek} , BODY{type: up or down } -&amp;gt; 200&amp;nbsp; response boody { total_vote:&amp;nbsp; }&lt;br&gt;&lt;br&gt;&lt;/blockquote&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="30" y="200" width="680" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-0" target="Vm4RPs8cP-7FOJJW0_Dn-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-0" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="80" y="670" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-1" target="Vm4RPs8cP-7FOJJW0_Dn-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-1" value="like service" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="210" y="670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-3" value="like store" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="460" y="670" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-5" value="&lt;div&gt;schema:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;p_id(idx) | u_id(idx) | status (like or not) | ts&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="630" y="670" width="250" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-6" value="&lt;div&gt;see count:&amp;nbsp;&amp;nbsp;1 p+_id, do COUNT()&amp;nbsp;&amp;nbsp; -&amp;gt; slow , 1M qps&lt;br&gt;&lt;/div&gt;&lt;div&gt;click like:&amp;nbsp; p_id + u_id -&amp;gt; ts , tru false 100k qps,&lt;br&gt;&lt;/div&gt;&lt;div&gt;see if I liked: p_id + u_id ,&amp;nbsp; qps 1M &lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="80" y="780" width="500" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-7" value="&lt;div&gt;bottleneck:&lt;/div&gt;&lt;div&gt;1. mysql&amp;nbsp; cant bear so much traffic:&amp;nbsp;&amp;nbsp; read, write .&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;read -&amp;gt; cache,&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;write -&amp;gt; mq to buffer, batch sevice to batch, lower pressure. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="80" y="870" width="610" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-9" target="Vm4RPs8cP-7FOJJW0_Dn-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-9" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="50" y="1415" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-11" target="Vm4RPs8cP-7FOJJW0_Dn-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-11" value="like consuer" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="280" y="1040" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-12" value="like db" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="460" y="1040" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-13" value="&lt;span style=&quot;&quot;&gt; &lt;/span&gt;write -&amp;gt; mq to buffer, batch sevice to batch, lower pressure." style="text;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="50" y="990" width="330" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-14" target="Vm4RPs8cP-7FOJJW0_Dn-19" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="260" y="1085" />
              <mxPoint x="260" y="1210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-14" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="140" y="1040" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-15" value="&lt;div&gt;smooth processing, &lt;br&gt;&lt;/div&gt;&lt;div&gt;consumer easy to scale&lt;/div&gt;&lt;div&gt;mq shift load&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="600" y="960" width="140" height="50" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-17" value="&lt;div&gt;large amount of data, large aount of traffic:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;partition the db (consisten hashing), vitess for mysql, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;if read is too much: replica to seperate wrie and read here. &lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="610" y="1040" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-18" value="&lt;div&gt;bottle2: fetch count, but it is scanning the whole talbe: &lt;br&gt;&lt;/div&gt;&lt;div&gt;relaxing the concsitency, denormalize: &lt;br&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="-105" y="1195" width="290" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-19" value="post like db&lt;br&gt;[pid | count]" style="ellipse;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="460" y="1170" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-21" value="batch update" style="rounded=0;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="280" y="1190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-22" value="store 1 sec data, merge by p_id, write to db" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="285" y="1260" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-23" value="lower db pressure, lower write frequency" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="380" y="1320" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-24" value="read" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="-100" y="1430" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-25" target="Vm4RPs8cP-7FOJJW0_Dn-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-25" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="90" y="1050" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-33" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-31" target="Vm4RPs8cP-7FOJJW0_Dn-32" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-31" value="like cnt service" style="rounded=0;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="280" y="1410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-32" value="redis" style="rounded=0;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="325" y="1510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-34" value="&lt;div&gt;cache aside, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;relative short ttl.&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="440" y="1540" width="110" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-37" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-35" target="Vm4RPs8cP-7FOJJW0_Dn-36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-35" value="full in-memoery db to hold all the data" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="560" y="1475" width="120" height="20" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-36" value="&lt;div&gt;fault tolerance: &lt;br&gt;&lt;/div&gt;&lt;div&gt;hot standby, &lt;br&gt;&lt;/div&gt;&lt;div&gt;persistence, to file, to db&lt;br&gt;&lt;/div&gt;" style="whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="760" y="1455" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-38" target="Vm4RPs8cP-7FOJJW0_Dn-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-38" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="50" y="1580" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-39" value="read if I like" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="-100" y="1595" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-42" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.018;entryY=0.325;entryDx=0;entryDy=0;entryPerimeter=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-40" target="Vm4RPs8cP-7FOJJW0_Dn-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-44" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-40" target="Vm4RPs8cP-7FOJJW0_Dn-43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-40" value="like svc" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="280" y="1580" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-43" value="cache" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="354" y="1694" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-46" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.129;entryY=0.019;entryDx=0;entryDy=0;entryPerimeter=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-45" target="Vm4RPs8cP-7FOJJW0_Dn-31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-45" target="Vm4RPs8cP-7FOJJW0_Dn-40" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-45" value="read a post svc" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="40" y="1260" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-48" value="&lt;div&gt;improve: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;like cnt service&lt;br&gt;&lt;/div&gt;&amp;nbsp;- inconcnistenc,&amp;nbsp; not accurate. " style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="-70" y="1790" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-52" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-53" target="Vm4RPs8cP-7FOJJW0_Dn-59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-53" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="120" y="2265" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-55" target="Vm4RPs8cP-7FOJJW0_Dn-56" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-79" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-55" target="Vm4RPs8cP-7FOJJW0_Dn-78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-55" value="like consuer" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="350" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-72" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-56" target="Vm4RPs8cP-7FOJJW0_Dn-73" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="770" y="2030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-56" value="like db" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="530" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-58" target="Vm4RPs8cP-7FOJJW0_Dn-59" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="330" y="1935" />
              <mxPoint x="330" y="2060" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-58" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="210" y="1890" width="80" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-59" value="post like db&lt;br&gt;[pid | count]" style="ellipse;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="530" y="2020" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-60" value="batch update" style="rounded=0;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="350" y="2040" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-61" value="store 1 sec data, merge by p_id, write to db" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="355" y="2110" width="160" height="40" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-62" value="lower db pressure, lower write frequency" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="450" y="2170" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-63" value="read" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="-30" y="2280" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-65" target="Vm4RPs8cP-7FOJJW0_Dn-55" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-65" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="160" y="1900" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-66" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-67" target="Vm4RPs8cP-7FOJJW0_Dn-77" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="455" y="2360" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-76" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.4;entryY=0.975;entryDx=0;entryDy=0;entryPerimeter=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-67" target="Vm4RPs8cP-7FOJJW0_Dn-75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-67" value="like cnt service" style="rounded=0;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="350" y="2260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-70" value="today&#39;s real time data" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="500" y="1990" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-73" value="daily snapshort" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="750" y="2020" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-74" value="daily snapshort" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="760" y="2030" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-75" value="daily snapshort" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="770" y="2040" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-77" value="cache" style="rounded=0;whiteSpace=wrap;html=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="460" y="2360" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;" parent="yrexTqZfdFiRCdiGLR_K-1" source="Vm4RPs8cP-7FOJJW0_Dn-78" target="Vm4RPs8cP-7FOJJW0_Dn-73" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vm4RPs8cP-7FOJJW0_Dn-78" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="yrexTqZfdFiRCdiGLR_K-1" vertex="1">
          <mxGeometry x="590" y="1790" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="AZ77vJw2ojLxVnteHUjz" name="upstart signup page">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-0" />
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-1" parent="6J5aaT0vLCsX0WpH28Cg-0" />
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-14" value="&lt;div&gt;sign&amp;nbsp; on system&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;func req&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sign on: name/pswd,&amp;nbsp; oauth?&amp;nbsp; ,,&amp;nbsp; guest?&amp;nbsp; sso?&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;non-func:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;availability &amp;gt; consistency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;security&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;user flow:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; sign up -&amp;gt; provide: name, pswd, email, phone&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;-&amp;gt; auth code to email and phone, or an auth link to email and phone, need to click within 30min&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;-&amp;gt; auth succeed. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; login page -&amp;gt; choose method to login:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;u/pswd&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;oauth: google, fb, linkedin&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;login as guest&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; 1st page -&amp;gt; do things&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; another page -&amp;gt; no need to login again&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; 3rd page ...&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; log out on 3rd page&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user -&amp;gt; 1st page -&amp;gt; need to login again. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;HTTPS:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/user/signup, body: {uname, pswd, email, phone } --&amp;gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;good: 301 redirect to real page, notice to click the lnk inside (email, phone, app) , set_cookie&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;bad: err 4xx, show error cause. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/user/login, body: {uname, pswd} --&amp;gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;good: return cookie.&amp;nbsp; 200OK, or 301 redirect&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;bad: return 4xxx, error&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; POST api/v1/signout {uname, token} --&amp;gt; ok or fail &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/otherpath, {uname, token } --&amp;gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;401 unAuth, 403 forbidden, 500 error&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="40" y="50" width="510" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-16" value="1. signup" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-15" target="6J5aaT0vLCsX0WpH28Cg-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-15" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="90" y="760" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-17" target="6J5aaT0vLCsX0WpH28Cg-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="470" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-17" target="6J5aaT0vLCsX0WpH28Cg-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-17" value="signup svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="260" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-22" value="user store" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="470" y="720" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-23" value="login method store" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="470" y="820" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-27" value="&lt;div&gt;name/pswd table&lt;/div&gt;&lt;div&gt;google oauth table&lt;/div&gt;&lt;div&gt;fb oatuth table&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="610" y="835" width="100" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-28" value="2. sign in" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-29" target="6J5aaT0vLCsX0WpH28Cg-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-37" value="4. take cookie (token)" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-29" target="6J5aaT0vLCsX0WpH28Cg-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="260" y="1030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-29" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="90" y="890" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-36" value="3. return cookie" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="140" y="935" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-30" value="signup svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="260" y="890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-40" value="5.2 check w/ signup svc" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-38" target="6J5aaT0vLCsX0WpH28Cg-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-38" value="other system" style="whiteSpace=wrap;html=1;aspect=fixed;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="240" y="1040" width="80" height="80" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-39" value="5.1 self auth" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=1;entryY=0.75;entryDx=0;entryDy=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" source="6J5aaT0vLCsX0WpH28Cg-38" target="6J5aaT0vLCsX0WpH28Cg-38" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="400" y="1060" />
              <mxPoint x="400" y="1100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-41" value="&lt;div&gt;user store:&amp;nbsp;&amp;nbsp; uid | real - name | address .... profiles. &lt;br&gt;&lt;/div&gt;&lt;div&gt;login_method_store:&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;name_pswd table:&amp;nbsp; uid | name | pswd &amp;nbsp; ( no real pswd, hashed, salted, slow hashed )&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;oauth table: uid | provider_name | oauth_id | access token | expires | refresh_token&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;api table: uid | api_key | api_secret&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="40" y="1160" width="740" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-42" value="Text" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="200" y="1140" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-43" value="&lt;div&gt;how cookie token is generated: &lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="30" y="1300" width="380" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-44" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="70" y="1390" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-45" value="login svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="220" y="1390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-46" value="oauth provider" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="460" y="1390" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-52" value="I want to login via oauth" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1530" as="sourcePoint" />
            <mxPoint x="260" y="1530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-53" value="redirect to oauth" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="1600" as="sourcePoint" />
            <mxPoint x="90" y="1600" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-55" value="login on oauth" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1630" as="sourcePoint" />
            <mxPoint x="520" y="1630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-56" value="redirect to login svc with a code" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="1710" as="sourcePoint" />
            <mxPoint x="90" y="1710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-65" value="oauth authen, create a pair:&amp;nbsp; code : access code : u_id" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="540" y="1620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-67" value="login again with code" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1770" as="sourcePoint" />
            <mxPoint x="260" y="1770" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-68" value="check w/ oauth the code, get access code, get info" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="260" y="1800" as="sourcePoint" />
            <mxPoint x="560" y="1800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-69" value="return good, access code" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="540" y="1850" as="sourcePoint" />
            <mxPoint x="290" y="1850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-70" value="create a token/session for this user" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="230" y="1890" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-71" value="return token/session id in cookie" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="300" y="2010" as="sourcePoint" />
            <mxPoint x="105" y="2010" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-72" value="sso to other pages" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="2060" as="sourcePoint" />
            <mxPoint x="280" y="2060" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-73" value="&lt;div&gt;jwt token:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;salt&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="100" y="2130" width="520" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-74" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="120" y="2260" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-75" value="login" style="rounded=1;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="550" y="2260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-76" value="uname pswd" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="2300" as="sourcePoint" />
            <mxPoint x="530" y="2300" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-77" value="return token/session id in cookie" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="520" y="2470" as="sourcePoint" />
            <mxPoint x="160" y="2470" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-78" value="&lt;div&gt;1. md5(pswd + salt), auth&lt;/div&gt;&lt;div&gt;2. create a jwt token: &lt;br&gt;&lt;/div&gt;&lt;div&gt;{&lt;/div&gt;&lt;div&gt;uname, &lt;br&gt;&lt;/div&gt;&lt;div&gt;expiry,&lt;/div&gt;&lt;div&gt;md5(uname+expiery+pswd)&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="620" y="2338" width="190" height="132" as="geometry" />
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-79" value="login again, with token" style="endArrow=classic;html=1;rounded=0;" parent="6J5aaT0vLCsX0WpH28Cg-1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160" y="2550" as="sourcePoint" />
            <mxPoint x="520" y="2550" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6J5aaT0vLCsX0WpH28Cg-80" value="&lt;div&gt;1. get uname, expiery, hash&lt;/div&gt;&lt;div&gt;2. check expiery, &lt;br&gt;&lt;/div&gt;&lt;div&gt;3. recalc jwt token, compare with hash. &lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" parent="6J5aaT0vLCsX0WpH28Cg-1" vertex="1">
          <mxGeometry x="550" y="2570" width="190" height="132" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="48x7h1dFR0f9NhL7fWYP" name="upstart online game">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-0" />
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-1" parent="_ABCVf9kDW8Ui17VEOTW-0" />
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-2" value="&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; Go game, web based. &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;1: 1&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;10K games at the same time. &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;Functional requirement: &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;i. Matching same lvl players&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ii. Real time games&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iii. Web-based front end. &lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iv. Customized matching player&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;Un functional requirement:&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;i. Real time experience&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;ii. Consistent b/w parties&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iii. High available&lt;br&gt;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;iv. Scale ?&amp;nbsp; Is it really necessary? &lt;br&gt;Isolation. " style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="50" y="30" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-3" value="&lt;div&gt;func req:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. user find a match&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. user place chess, user read opponent step, user step is timed&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;3. user win or oppo win&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;4. user has scores, leaderboard&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;5. user see replay&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;6. user broke and can re-link&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;non fun:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;consistency &amp;gt; availability&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;connection is iimportant, need t recvei data from server&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durability : not very import&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;place chess:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/positions?&amp;nbsp; header: {user token}, body { + positions} -&amp;gt; 200OK {}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;poll opponents chess:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/positions?&amp;nbsp; --&amp;gt; 200 response , body { + positions,&amp;nbsp; users: oopponnetns}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;poll game status&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/status? --&amp;gt; 200 response, body {status: CONTINUE, SUCCEED, FAIL, your total score: xx}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="40" y="330" width="710" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-8" value="1. send pos1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-4" target="_ABCVf9kDW8Ui17VEOTW-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-4" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="110" y="740" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-9" value="&lt;div&gt;4.1 if not finish, write to actor 2&lt;/div&gt;&lt;div&gt;4.2 if finish, write result to actor 2&lt;br&gt;&lt;/div&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-5" target="_ABCVf9kDW8Ui17VEOTW-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-5" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="90" y="1010" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-11" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-7" target="_ABCVf9kDW8Ui17VEOTW-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.014;entryY=0.15;entryDx=0;entryDy=0;entryPerimeter=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-7" target="_ABCVf9kDW8Ui17VEOTW-15" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-7" value="go server" style="rounded=0;whiteSpace=wrap;html=1;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="390" y="860" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-10" value="status of games" style="ellipse;whiteSpace=wrap;html=1;rounded=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="630" y="860" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-12" value="&lt;div&gt;2. write pos1 to the game&lt;/div&gt;&lt;div&gt;3. judge the status of the game&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="390" y="810" width="246" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-13" value="&lt;div&gt;mysql&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;game_id | serialized_game | next player | last updated time | created ts | status | p1 | p2 &lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;pk: game_id&lt;/div&gt;&lt;div&gt;idx: game_id, p1, p2, last updated time, status&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="650" y="930" width="600" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-14" value="&lt;div&gt;communication: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;push service to notify players: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;oppo has a new move, the game has a new status&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;websocket,&amp;nbsp; duplex , send notification:&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;notification: you have a new msg, you can poll it.&amp;nbsp; -&amp;gt;&amp;nbsp; call Poll new status: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;(rarely) send bakck the real data:&amp;nbsp;&amp;nbsp; ws get apixxxx to get new status. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;long polling:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;http1 ,&amp;nbsp; it is old but still can work.&amp;nbsp;&amp;nbsp;&amp;nbsp; take more internal resources.&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;good:&amp;nbsp; easy to impl. ws might have difficulties when network not stable. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Improve: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. go server:&amp;nbsp; not update db directly ,&amp;nbsp; use redis instead.&amp;nbsp;&amp;nbsp;&amp;nbsp; in-meory,&amp;nbsp; easy to expand,&amp;nbsp; fast. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. data:&amp;nbsp; hot data / cold data&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;3. database:&amp;nbsp; expand: sharding, nosql. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;4. push service scale up:&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;also use redis to find who is connecting to which push host. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="30" y="1100" width="910" height="30" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;exitPerimeter=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-15" target="_ABCVf9kDW8Ui17VEOTW-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0;exitDx=35;exitDy=60;exitPerimeter=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="_ABCVf9kDW8Ui17VEOTW-1" source="_ABCVf9kDW8Ui17VEOTW-15" target="_ABCVf9kDW8Ui17VEOTW-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_ABCVf9kDW8Ui17VEOTW-15" value="push service" style="shape=callout;whiteSpace=wrap;html=1;perimeter=calloutPerimeter;" parent="_ABCVf9kDW8Ui17VEOTW-1" vertex="1">
          <mxGeometry x="130" y="880" width="70" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="rHCOIgxjY1NBL3UfVlVm" name="youtube">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-0" />
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-1" parent="hFYnyOzCzlfvdMKFOy-9-0" />
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-2" value="&lt;div&gt;FR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;upload&amp;nbsp; videos&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;view video list&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;view videos online&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;NFR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; many &lt;/span&gt;videos&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;view from anywhere&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;upload latency: high&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;view videos latency: low&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;avail &amp;gt; consistency&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;upload video:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/upload, body {token, resource_location: }&amp;nbsp; -&amp;gt; 200 ok, response {video_id, video_link}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;view video&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;(video is segmented into pieces, we are queyr piece a time)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/videos/id ? offset=xxx &amp;amp;&amp;amp; limit=xxx , -&amp;gt; 200 ok, response {vidod_id, chunks : [content of this videos]} &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;view video lists&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET apip/v1/videoList , header {token}&amp;nbsp; -&amp;gt; 200 ok { list: [ {v_id, v_link, v_title} ] }&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="30" y="40" width="720" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-6" value="1. I want to upload a video" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-3" target="hFYnyOzCzlfvdMKFOy-9-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-10" value="3. upload" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-3" target="hFYnyOzCzlfvdMKFOy-9-11" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="105" y="730" as="targetPoint" />
            <Array as="points">
              <mxPoint x="110" y="700" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-3" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="90" y="490" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-4" value="uploda" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="30" y="430" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-7" value="2. ok, this is your v_id, you can upload it to here. " style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-5" target="hFYnyOzCzlfvdMKFOy-9-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-5" target="hFYnyOzCzlfvdMKFOy-9-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-5" value="meatadata svc" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="480" y="490" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-8" value="metadata db" style="ellipse;whiteSpace=wrap;html=1;verticalAlign=top;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="930" y="830" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-12" value="4. update status" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.092;entryY=0.8;entryDx=0;entryDy=0;entryPerimeter=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-11" target="hFYnyOzCzlfvdMKFOy-9-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="250" y="690" />
              <mxPoint x="941" y="690" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-11" target="hFYnyOzCzlfvdMKFOy-9-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="350" y="770" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-11" value="obj store" style="rounded=0;whiteSpace=wrap;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="160" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-14" target="hFYnyOzCzlfvdMKFOy-9-16" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="540" y="770" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.433;entryY=0.917;entryDx=0;entryDy=0;entryPerimeter=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-14" target="hFYnyOzCzlfvdMKFOy-9-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="450" y="880" />
              <mxPoint x="732" y="880" />
              <mxPoint x="732" y="885" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-14" value="transcoder, filter, dedup" style="rounded=0;whiteSpace=wrap;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="360" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-16" target="hFYnyOzCzlfvdMKFOy-9-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;entryX=0.792;entryY=0.85;entryDx=0;entryDy=0;entryPerimeter=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-16" target="hFYnyOzCzlfvdMKFOy-9-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="670" y="850" />
              <mxPoint x="775" y="850" />
              <mxPoint x="775" y="881" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-16" value="processed store" style="rounded=0;whiteSpace=wrap;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="550" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.4;exitY=0.1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-18" target="hFYnyOzCzlfvdMKFOy-9-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="798" y="820" />
              <mxPoint x="1070" y="820" />
              <mxPoint x="1070" y="860" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-18" value="&lt;div&gt;CDN&lt;/div&gt;" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;rounded=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="750" y="730" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-22" target="hFYnyOzCzlfvdMKFOy-9-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="200" y="960" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-22" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="90" y="1010" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-24" target="hFYnyOzCzlfvdMKFOy-9-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-24" value="GW" style="rounded=0;whiteSpace=wrap;html=1;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="200" y="1010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0.367;entryY=1.067;entryDx=0;entryDy=0;entryPerimeter=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-25" target="hFYnyOzCzlfvdMKFOy-9-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.55;entryY=0.95;entryDx=0;entryDy=0;entryPerimeter=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" source="hFYnyOzCzlfvdMKFOy-9-25" target="hFYnyOzCzlfvdMKFOy-9-18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-25" value="playSvc" style="whiteSpace=wrap;html=1;rounded=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="440" y="1010" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="hFYnyOzCzlfvdMKFOy-9-30" value="&lt;div&gt;bottleneck:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. huge upload amounts:&amp;nbsp; mq, load shift, async process.&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; multi process to do transcoder. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. CDN bottleneck:&amp;nbsp;&amp;nbsp; multi region CDN,&amp;nbsp; local read, global write.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;3. playSvc:&amp;nbsp; too many people see 1 video:&amp;nbsp; CND replica&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;4. save traffic:&amp;nbsp;&amp;nbsp; control download speed by viewing process. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;5. upload traffic: rate limiting, not upload full speed.&amp;nbsp;&amp;nbsp; Need to control bandwidth!! &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;6. how to dedup:&amp;nbsp; checksum, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;7. compress:&amp;nbsp;&amp;nbsp;&amp;nbsp; save disks&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;8. &lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="hFYnyOzCzlfvdMKFOy-9-1" vertex="1">
          <mxGeometry x="60" y="1150" width="810" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="1yHAf2ZltARBBW7P2lwa" name="crawler">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="sYQ7aKpWDocMD4myl1Jn-0" />
        <mxCell id="sYQ7aKpWDocMD4myl1Jn-1" parent="sYQ7aKpWDocMD4myl1Jn-0" />
        <mxCell id="sYQ7aKpWDocMD4myl1Jn-2" value="&lt;div&gt;FR&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;crawl urls&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;no cyclic crawl&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;no too deep inside 1 domain&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;as many as possible&lt;/div&gt;&lt;div&gt;NFR&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;available .&amp;gt; consistency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data amount huge&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;no latency req&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;capacity:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;disk 1month : 1B url * 1kb -&amp;gt; 1TB data , 10TB / yr, 30TB/ 3yr&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;network bandwidth: 1TB/30 = 300GB / 10^5 = 3MB/s = 24Mb/s&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;arch:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;url store -&amp;gt; scheduler -&amp;gt; crawler farm -&amp;gt; raw store -&amp;gt; processors (rid of images, rid of ads, dedup, extract new urls, indexed) -&amp;gt; processed store&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;-&amp;gt; url store&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;rely on: stateless components,&amp;nbsp; easy to scale&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;retry mechanism&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;bottleneck:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. crawler farm:&amp;nbsp;&amp;nbsp; need more host, need to change IP, need to be a nice crawler robot, might&amp;nbsp; use proxy. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. crawler farm: download network bandwidth, more hosts. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;3. crawler farm: NIO framework, save resources. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;4. raw store: need big disk,&amp;nbsp; HDFS, big data file system. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;5. post processing: similar to youtube design&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;6. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;tricks: bloomfilter&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="sYQ7aKpWDocMD4myl1Jn-1" vertex="1">
          <mxGeometry x="40" y="40" width="680" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="udAKP1Y_BOkuldcwaa5l" name="shorturl">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-0" />
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-1" parent="JYRfqtTVYQpH9AIqoDx0-0" />
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-2" value="&lt;div&gt;short url&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;user -&amp;gt; long url -&amp;gt; short url -&amp;gt; long url :&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FR: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1 long url - always same shor turl &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;custom short url&lt;/div&gt;&lt;div&gt;NFR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;read &amp;gt;&amp;gt; write&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;huge read&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;latency low&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durability: not extreeme high&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;capacity:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;qps 1M , write qps 10k &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;disk:&amp;nbsp; 1k / rec,&amp;nbsp; 10MB / s, 10MB x 60 x 60 x 24 x 365 = 10MB x 1e5 x 365 = 365 TB / yr&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;network: 10MB/s = 80Mb/s&amp;nbsp; , easy&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;MVP:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="40" y="80" width="660" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-5" value="1. req" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-3" target="JYRfqtTVYQpH9AIqoDx0-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-3" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="100" y="500" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-4" value="write url:" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="50" y="450" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-7" value="2 persist" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-6" target="JYRfqtTVYQpH9AIqoDx0-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="530" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-9" value="3. reply" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-6" target="JYRfqtTVYQpH9AIqoDx0-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="215" y="545" />
              <mxPoint x="215" y="550" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-6" target="JYRfqtTVYQpH9AIqoDx0-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="390" y="630" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-22" value="5.2 search db" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.042;entryY=0.7;entryDx=0;entryDy=0;entryPerimeter=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-6" target="JYRfqtTVYQpH9AIqoDx0-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-23" value="6. reply" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-6" target="JYRfqtTVYQpH9AIqoDx0-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-6" value="shorten svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="300" y="500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-8" value="db" style="ellipse;whiteSpace=wrap;html=1;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="560" y="490" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-10" value="long url | short url" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="600" y="430" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-11" value="read url:" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="50" y="585" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-19" value="4. read" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.25;entryY=1;entryDx=0;entryDy=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" source="JYRfqtTVYQpH9AIqoDx0-12" target="JYRfqtTVYQpH9AIqoDx0-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-12" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="100" y="640" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-21" value="5.1 cache" style="rounded=0;whiteSpace=wrap;html=1;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="354" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="JYRfqtTVYQpH9AIqoDx0-24" value="&lt;div&gt;schema:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;long url | short url | create_u | creat_ts | expiry &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;how short url is generated: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. UUID:&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2. mysql inre id&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;3. uniq id service&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="JYRfqtTVYQpH9AIqoDx0-1" vertex="1">
          <mxGeometry x="50" y="770" width="710" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="COHWfg5ImKXhd_WGajoV" name="leetcode">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-1" value="&lt;div&gt;online coding &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;I can type code and run and go thru tests&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;I can choose questions&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;NFR:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;response time: ~seconds&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;available: medium - high&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durability: low&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;security: high&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;scale up: yes&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;capacity:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user: DAU 5M.  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;read Q: read db;  post code: write db&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;read &amp;gt;&amp;gt; write,  cache&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;5M * 5 / (24 * 60 * 60) = 25 qps, write qps, low.   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;q read: 5M * 100 / 1e5 = 5k.  &lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data storage:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;submissions: 5M * 5 * 1KB * 365 = 5GB * 1500 ~ 10TB / yr&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;questions: 10K * 1kB = 10MB&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;test cases: 10K * 1kB = 10MB&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;computation resources:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;25 q/s * 0.1s -&amp;gt; 2.5s,   &amp;gt; 1s, so more than 1 machine is needed. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;computation timeout:  10s&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;~ 20 hosts to do computation.     &lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;bandwidth: small&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;API: &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;see question:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/questions/ id , header{token}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;run code remotely:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/answers / id , header {token}, body { language, code|}  - 200OK, response body {ok or fail,  run time, pct, fail info : {error unit test: {}}}&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;DATA:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;q data; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;submission data;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user data; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;MVP:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="60" width="710" height="30" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bWv7Bu238bYSYBqhzJ9i-2" target="bWv7Bu238bYSYBqhzJ9i-4">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="190" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-2" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="1">
          <mxGeometry x="60" y="940" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bWv7Bu238bYSYBqhzJ9i-4" target="bWv7Bu238bYSYBqhzJ9i-6">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="bWv7Bu238bYSYBqhzJ9i-4" target="bWv7Bu238bYSYBqhzJ9i-9">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" edge="1" parent="1" source="bWv7Bu238bYSYBqhzJ9i-4" target="bWv7Bu238bYSYBqhzJ9i-14">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="230" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-4" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="170" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="bWv7Bu238bYSYBqhzJ9i-6" target="bWv7Bu238bYSYBqhzJ9i-8">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="620" y="1030" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-6" value="runCode svc" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="370" y="1000" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-8" value="run history db" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="620" y="990" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" edge="1" parent="1" source="bWv7Bu238bYSYBqhzJ9i-9" target="bWv7Bu238bYSYBqhzJ9i-12">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="600" y="910" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-9" value="question svc" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="370" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-12" value="q db" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="620" y="870" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-14" value="user service" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="170" y="830" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="bWv7Bu238bYSYBqhzJ9i-15" value="&lt;div&gt;deepdive:&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;span&gt; &lt;/span&gt;gw: stateless,&amp;nbsp; cluster, easy to scale up. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;q_svc:&amp;nbsp; 5k qps, 3 hosts,&amp;nbsp; use cache to lower the pressure &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;q_db: 1 mysql + 1 replica is enough. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;runCOde svc: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;25 hosts&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;async processing:&amp;nbsp; 25qps .&amp;nbsp; build -&amp;gt; run&amp;nbsp; tests -&amp;gt; get results -&amp;gt; save history. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;history db: cold hot separation. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;Isolation:&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;docker&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;Code Processor will create a new docker container &lt;b&gt;with specified &lt;br&gt;language compiler / interpreter&lt;/b&gt; each time with some specific time like &lt;br&gt;n seconds and it will destroy itself when work is complete or time &lt;br&gt;expired.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;calibri&amp;#34;&quot;&gt;Docker&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;calibri&amp;#34;&quot;&gt;Docker&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;calibri&amp;#34;&quot;&gt;Docker&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;calibri&amp;#34;&quot;&gt;Docker&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-family: &amp;#34;calibri&amp;#34;&quot;&gt;Docker&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;calibri&amp;#34;&quot;&gt;Docker&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-family: &amp;#34;microsoft yahei&amp;#34;&quot;&gt;MQ --&amp;gt; cluster of running hosts. &lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span lang=&quot;zh-CN&quot;&gt;submission&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt; table&lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt; sql row is 8kb, &lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt;&lt;br&gt;code &lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt;&lt;span&gt;&amp;nbsp; &lt;/span&gt;&lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt;code &lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt; mongodb &lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt; obj storage &lt;/span&gt;&lt;span lang=&quot;zh-CN&quot;&gt;&lt;/span&gt;&lt;span lang=&quot;en-US&quot;&gt; &lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span lang=&quot;en-US&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span lang=&quot;en-US&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span lang=&quot;en-US&quot;&gt;25qps * 200ms/run -&amp;gt; 5s cpu time / sec -&amp;gt; 5 docker -&amp;gt; 10docker.&amp;nbsp; &lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span lang=&quot;en-US&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="60" y="1150" width="660" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="p1yfV-OEFi7TEZK4TrmI" name="instagram">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="VcHaPxS8vzP71JO6Yqi7-1" value="&lt;div&gt;instagram&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user follow unfollow others&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user see all posts from all others&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user post images&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user comments&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user likes&lt;/div&gt;&lt;div&gt;NFRR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;avail &amp;gt; consistrency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durability&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;latency: low&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Cap:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;DAU&amp;nbsp; 1B&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="50" y="40" width="730" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="e-OsCG2rvTypIU3B7pst" name=" Analyze ads click count ">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="zJ7GIJuXjs18yOTxALoC-1" value="&lt;br&gt;&lt;div&gt;Analyze ads click count &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;ads id -&amp;gt; click -&amp;gt; backend -&amp;gt; chart -&amp;gt; do analysis&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="30" y="50" width="730" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="UvsD0gzJbqKx5TIT_Xpi" name="topK">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-23" value="topK svc" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="240" y="410" width="530" height="660" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-1" value="&lt;div&gt;topk&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;R:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;(k, v, ts) -&amp;gt; system -&amp;gt; 1. real time query, topK in recnet 1min, 1h, 1day.&amp;nbsp; 2. topK query for a time range. &lt;br&gt;&lt;/div&gt;&lt;div&gt;NF:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;large write, large read&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;low latency on read req&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;time lag b/w input and output ~ 1min, not very time sensigtive&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;AP &amp;gt; CP &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;accuracy -&amp;gt; high&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data retention: 1yrs? &lt;br&gt;&lt;/div&gt;&lt;div&gt;Cap:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;qps of input data?&amp;nbsp; 1M qps, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;pqs of out put data?&amp;nbsp; 1M qps, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;type of data: (k, v, ts, cnt? )&amp;nbsp; &amp;nbsp; key : host:service:location...... -&amp;gt; 0.1kb,&amp;nbsp; value: int,&amp;nbsp; ts: int, cnt: int, so data size is 0.1k on avg. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; POST api/v1/topkbody: {servicename, key, value, ts}, -&amp;gt; 200 OK, 4xx error, 5xx error,  429 rate limit. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/topk/ key_id? start_time == &amp;amp;&amp;amp; end_ts == , -&amp;gt; range query , 200OK body{}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/topk/ key_id ,  streaming api &lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="50" y="50" width="670" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-19" value="data provider" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="20" y="510" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-20" value="data provider" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="520" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-22" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-21" target="6rHGbZ4IgaMDwjD5DAKy-23">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="220" y="560" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-21" value="data provider" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-25" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-23" target="6rHGbZ4IgaMDwjD5DAKy-24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-23" target="6rHGbZ4IgaMDwjD5DAKy-26">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="260" y="590" />
              <mxPoint x="260" y="515" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-59" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-24" target="6rHGbZ4IgaMDwjD5DAKy-57">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-24" value="viewers" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="1050" y="530" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-30" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-26" target="6rHGbZ4IgaMDwjD5DAKy-29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-51" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-26" target="6rHGbZ4IgaMDwjD5DAKy-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-26" value="data aggregator for 1min, 1h, 1day, in memory" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="470" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-29" value="&lt;div&gt;save to cache for consumming&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="440" y="415" width="210" height="145" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-38" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="460" y="490" width="80" height="220" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-31" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry y="10" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-32" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry x="10" y="20" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-33" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry x="20" y="30" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-34" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry x="30" y="40" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-35" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry x="40" y="50" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-36" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry x="50" y="60" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-37" value="for every minutes" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-38">
          <mxGeometry x="20" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-39" value="" style="group" vertex="1" connectable="0" parent="1">
          <mxGeometry x="550" y="490" width="80" height="220" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-40" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry y="10" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-41" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry x="10" y="20" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-42" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry x="20" y="30" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-43" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry x="30" y="40" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-44" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry x="40" y="50" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-45" value="hm1" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry x="50" y="60" width="20" height="160" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-46" value="for every hours" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="6rHGbZ4IgaMDwjD5DAKy-39">
          <mxGeometry x="20" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-47" value="cache to save calculation of this type of case: [ 3h 12min time range ]" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="790" y="710" width="140" height="70" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-50" target="6rHGbZ4IgaMDwjD5DAKy-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-50" value="persist layer" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-56" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-53" target="6rHGbZ4IgaMDwjD5DAKy-55">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-53" value="save data in order of time" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-58" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="6rHGbZ4IgaMDwjD5DAKy-55" target="6rHGbZ4IgaMDwjD5DAKy-57">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-55" value="mapreduce" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="480" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-57" value="slow accurate query API" style="whiteSpace=wrap;html=1;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="707" y="940" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6rHGbZ4IgaMDwjD5DAKy-60" value="cache" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="890" y="940" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Dpgf9jfWxoWgO7Cxq9nl" name="upstart online chess">
    <mxGraphModel dx="1038" dy="528" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="eW09PLhZNd3Z7wGGAa37-1" value="&lt;div&gt;online chess&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;online gaming, go game, 2player&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;real time, &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;player matching? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;game replay? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;leaderboard? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;resume? &lt;br&gt;&lt;/div&gt;&lt;div&gt;NFR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;scale? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;availability&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;consistency: low&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;accuracy on time&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;racing condition&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;data flow:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user --&amp;gt; login -&amp;gt;&amp;nbsp; pick opponent -&amp;gt; start game, confirmed by 2 players together -&amp;gt; place chess -&amp;gt; see p2 place chess -&amp;gt; place chess again -&amp;gt; win or lose -&amp;gt; gain points -&amp;gt; pick opponent.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;user login&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/login, body {uname, pswd} -&amp;gt; ok or not.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;start game: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/games/id/start, body{user} -&amp;gt; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;place chess:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/games/id/state, body {user, move} -&amp;gt; resp: { nxt_player, new state, nxt_timing, win_or_lose_or_continue}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;server push from other side:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;POST api/v1/games/id/state, body {cur_player, move, win_or_lose_or_continue}. -&amp;gt;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;get score or leaderboards&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/leaderboards&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;GET api/v1/scores , head {user token} &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;arch:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="40" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-2" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="60" y="690" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-3" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="60" y="870" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-4" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="210" y="700" width="60" height="70" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-5" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="110" y="740" as="sourcePoint" />
            <mxPoint x="180" y="810" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-6" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="170" y="830" as="sourcePoint" />
            <mxPoint x="90" y="780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-7" value="" style="endArrow=classic;html=1;rounded=0;startArrow=none;" parent="1" source="eW09PLhZNd3Z7wGGAa37-36" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="870" as="sourcePoint" />
            <mxPoint x="170" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-8" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="160" y="890" as="sourcePoint" />
            <mxPoint x="100" y="900" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-9" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="230" y="850" as="sourcePoint" />
            <mxPoint x="400" y="804.5" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-10" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="400" y="830" as="sourcePoint" />
            <mxPoint x="230" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-11" value="game svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="410" y="775" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-12" value="game svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="420" y="785" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-13" value="game svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="430" y="800" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-14" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="630" y="890" as="sourcePoint" />
            <mxPoint x="670" y="850" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-15" value="db" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="690" y="810" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-16" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="eW09PLhZNd3Z7wGGAa37-13" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="510" y="960" as="sourcePoint" />
            <mxPoint x="530" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-17" value="redis" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="540" y="910" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-18" value="redis" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="550" y="920" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-19" value="redis" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="560" y="930" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-20" value="db" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="700" y="820" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-21" value="db" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;" parent="1" vertex="1">
          <mxGeometry x="710" y="840" width="60" height="80" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-23" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="270" y="730" as="sourcePoint" />
            <mxPoint x="360" y="680" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-24" value="user svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="330" y="620" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-25" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="eW09PLhZNd3Z7wGGAa37-13" target="eW09PLhZNd3Z7wGGAa37-26" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="460" y="880" as="sourcePoint" />
            <mxPoint x="460" y="1060" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-26" value="kafka" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="1030" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-27" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="410" y="1060" as="sourcePoint" />
            <mxPoint x="330" y="1100" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-28" value="user history" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="200" y="1109" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-29" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="eW09PLhZNd3Z7wGGAa37-26" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="420" y="1070" as="sourcePoint" />
            <mxPoint x="430" y="1130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-30" value="replay svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="1150" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-31" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;" parent="1" source="eW09PLhZNd3Z7wGGAa37-26" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="440" y="1100" as="sourcePoint" />
            <mxPoint x="590" y="1120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-32" value="leaderboards" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="570" y="1130" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-33" value="&lt;div&gt;deepdive:&lt;/div&gt;&lt;div&gt;1. connections:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;polling&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;long polling&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;websocket&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;TCP UDP &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;NIO : async IO, huge enhancement. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;protocol?&amp;nbsp; protobuf bettern than http. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;2. gw: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;qps: low,&amp;nbsp; 10 srevers. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;retry: logic inside client side. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; websocket&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;tls offload&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;request routing. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;3. game service:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;no state! states are stored inside redis and db. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;db is the persist layer. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;use redis to speed up. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;interface:&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;new_state&amp;nbsp; changeState(user , newMove) {&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;curState = getCurStateFromRedis(); &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; try:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;curState.applyMove(user,&amp;nbsp; newMove);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;except:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sendError(user, curState)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;return&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;saveStateToRedis(curState)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sendState(toP1, curState);&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;sendState(toP2, curState);&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;}&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;essential: player online function:&amp;nbsp; ping, redis, user state. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;fault tolerance: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;if failed, pick up persisted state. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;if no resp from user, auto go / or change to robot / or halt the game. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;if 1 game is failed, other should not be affected. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;use docker/container to isolate games ( 100 games per docker ) .&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;4. redis:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;save all the state. fast read, fast write. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;easy to scale: redis cluster&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;fault tolerance: flush data every 5 sec. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;gossip protocol, consistent hashing to partition, sync replica. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;5. db: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;schema:&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;game id | chess state | curP | status (finish, continue, paused) | winner | players (player1_player2)&amp;nbsp; | created time | last update time | finished time | &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;fault:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;racing condition: locking on id. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;scale up: consistent hashing. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;6. offline:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;kafka: high throughput, fast speed. &lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;latency low: seconds. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;no data loss. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="1240" width="760" height="30" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-34" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="770" as="sourcePoint" />
            <mxPoint x="540" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-35" value="game rule engine" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="530" y="650" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-36" value="ws server" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="170" y="800" width="50" height="100" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-37" value="" style="endArrow=none;html=1;rounded=0;" parent="1" target="eW09PLhZNd3Z7wGGAa37-36" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="100" y="870" as="sourcePoint" />
            <mxPoint x="170" y="860" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-38" value="login" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="710" as="sourcePoint" />
            <mxPoint x="200" y="720" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-39" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="220" y="710" width="60" height="70" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-40" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="230" y="720" width="60" height="70" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-41" value="ws server" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="180" y="810" width="50" height="100" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-42" value="ws server" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="190" y="820" width="50" height="100" as="geometry" />
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-43" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="560" y="820" as="sourcePoint" />
            <mxPoint x="680" y="750" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="eW09PLhZNd3Z7wGGAa37-44" value="timer svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="680" y="700" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="XN5D-tEtyyXCtmnWTJpk" name="upstart">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="PjtR9K-not_MrZkwpJaf-1" value="&lt;div&gt;online chess game&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;FR:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;play chess, 2 players&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;match players&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;place chess &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;see other people place chess&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;judge win or loose&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;if disconnect, resume game.&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;scores/ leaderboards&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;game replay&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;br&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;NFR:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;consistency: 1p place chess and the other see it:&amp;nbsp; low, seconds of latency is tolerable&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;availability: high&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;data durability: yes, for resuming&lt;/div&gt;&lt;div&gt;&lt;span&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span&gt;Capacity:&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;DAU: 1M, 5 game per p -&amp;gt; 0.5*5 = 2.5M game per day , 1game 100 steps -&amp;gt; 250M steps /day -&amp;gt; qps: 2500 /s , req to place chess. &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;storage:   2.5M game -&amp;gt; 2.5M * 10kb -&amp;gt; 25GB/ day -&amp;gt; 8TB/year&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;network:  2500 qps * 1kb -&amp;gt; 2.5MBs -&amp;gt; 20Mbps &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;&lt;span&gt;data flow and API:&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;login&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;POST api/v1/login, body {uname, pswd} -&amp;gt; resp: 200OK, body {token:, session id: }&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;match player( async, keep polling)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;POST api/v1/matchings, header {user}, body {location, timezone} -&amp;gt; find user&#39;s rank, score -&amp;gt; resp: 200OK, body {game: id}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;polling match:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;GET api/v1/matchings/game_id ,  --&amp;gt; resp:  {state:, oponenent, game_url: }&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;show game&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;GET api/v1/game/id/states,  --&amp;gt; resp: body {current state, current player, remaining time}&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;place chess&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;post api/v1/game/id/states,  body {current change, current player}   -&amp;gt; resp:  {new state, current player, remaining time}&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;get new state of game&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;GET api/v1/game/id/states,  --&amp;gt; resp: body {current state, current player, remaining time}&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;get leaderboard&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;GET api/v1/leaderboard&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;get replay&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;GET api/v1/replays/game_id&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;arch:&lt;br&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="50" y="50" width="730" height="30" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#3333FF;" parent="1" source="PjtR9K-not_MrZkwpJaf-2" target="PjtR9K-not_MrZkwpJaf-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-2" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;strokeColor=#3333FF;" parent="1" vertex="1">
          <mxGeometry x="50" y="830" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.008;entryY=0.367;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-3" target="PjtR9K-not_MrZkwpJaf-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-3" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;strokeColor=#3333FF;" parent="1" vertex="1">
          <mxGeometry x="50" y="1020" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="PjtR9K-not_MrZkwpJaf-4" target="PjtR9K-not_MrZkwpJaf-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="320" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="PjtR9K-not_MrZkwpJaf-4" target="PjtR9K-not_MrZkwpJaf-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="PjtR9K-not_MrZkwpJaf-4" target="PjtR9K-not_MrZkwpJaf-12" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="450" y="910" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-4" value="GW" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="200" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-7" value="user svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="260" y="770" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-32" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;startArrow=classic;startFill=1;" parent="1" source="PjtR9K-not_MrZkwpJaf-9" target="PjtR9K-not_MrZkwpJaf-17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-9" value="match svc" style="whiteSpace=wrap;html=1;verticalAlign=top;" parent="1" vertex="1">
          <mxGeometry x="250" y="980" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="PjtR9K-not_MrZkwpJaf-12" target="PjtR9K-not_MrZkwpJaf-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="680" y="940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-12" target="PjtR9K-not_MrZkwpJaf-17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="490" y="1130" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-12" target="PjtR9K-not_MrZkwpJaf-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="550" y="1210" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;startArrow=none;startFill=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-12" target="PjtR9K-not_MrZkwpJaf-30" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Vys-x3-oDauHlWeav3wU-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;startArrow=classic;startFill=1;" parent="1" source="PjtR9K-not_MrZkwpJaf-12" target="Vys-x3-oDauHlWeav3wU-2" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="660" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-12" value="game svc" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#0000FF;" parent="1" vertex="1">
          <mxGeometry x="440" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.25;exitDx=0;exitDy=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-12" target="PjtR9K-not_MrZkwpJaf-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="560" y="920" />
              <mxPoint x="680" y="920" />
              <mxPoint x="680" y="910" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-13" value="redis" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#0000FF;" parent="1" vertex="1">
          <mxGeometry x="620" y="990" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-15" value="&lt;div&gt;db&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#0000FF;" parent="1" vertex="1">
          <mxGeometry x="800" y="880" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-17" value="long conn svc" style="rounded=0;whiteSpace=wrap;html=1;strokeColor=#000099;" parent="1" vertex="1">
          <mxGeometry x="210" y="1100" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-19" value="" style="endArrow=classic;html=1;rounded=0;startArrow=classic;startFill=1;" parent="1" target="PjtR9K-not_MrZkwpJaf-17" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="940" as="sourcePoint" />
            <mxPoint x="140" y="890" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-20" value="" style="endArrow=classic;html=1;rounded=0;startArrow=classic;startFill=1;entryX=0.083;entryY=0.167;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" target="PjtR9K-not_MrZkwpJaf-17" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="90" y="1070" as="sourcePoint" />
            <mxPoint x="251.57894736842104" y="1110" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.625;entryY=0.033;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=none;startFill=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-22" target="PjtR9K-not_MrZkwpJaf-25" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.4;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;startArrow=none;startFill=0;" parent="1" source="PjtR9K-not_MrZkwpJaf-22" target="PjtR9K-not_MrZkwpJaf-27" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-22" value="MQ" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="490" y="1180" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-23" value="" style="endArrow=classic;html=1;rounded=0;" parent="1" target="PjtR9K-not_MrZkwpJaf-24" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="480" y="1240" as="sourcePoint" />
            <mxPoint x="430" y="1270" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-24" value="user history" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="300" y="1260" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-25" value="replays" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="510" y="1320" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-27" value="analysis svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="700" y="1270" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="PjtR9K-not_MrZkwpJaf-30" value="timer service" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vys-x3-oDauHlWeav3wU-2" value="game rule engine" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="600" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="Vys-x3-oDauHlWeav3wU-3" value="Text" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="570" y="1220" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="Vys-x3-oDauHlWeav3wU-4" value="&lt;div&gt;deepdive:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1. communication:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;we need server push to user:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;polling&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;long polling&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;websocket&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;we need ping req on L7 to get user state (online, offline)&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;ping req every 1-3 seconds.&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;protocol: &amp;nbsp; http, protobuf, thrift&amp;nbsp; : &amp;nbsp;&amp;nbsp; protobuf is good, smaller size, faster&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;in future:&amp;nbsp; if too many users, QUIC/HTTP3, on UDP, lower resources consuming.&amp;nbsp; no http2 here. &amp;nbsp; &amp;nbsp; not necessary. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;trade off b/w&amp;nbsp; :&amp;nbsp; compression &amp;amp; data storage &amp;amp; computation&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;2.&amp;nbsp; game service;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;IO:&amp;nbsp; get state of games&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;compute:&amp;nbsp; calc rules and judge if any one win&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;disk: persistent&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;IO:&amp;nbsp; nonblocking,&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;compute:&amp;nbsp; cache rules ,&amp;nbsp; calculate on specific threads that won&#39;t block IO threads &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;disk:&amp;nbsp; redis for fast r/w, db (mysql ) for persistency,&amp;nbsp; redis cluster for scaling up.&amp;nbsp;&amp;nbsp;&amp;nbsp; game service becomes no state, and easy to scale up. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;3. redis:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;store state:&amp;nbsp;&amp;nbsp; game id:&amp;nbsp; {state, curP, last_update_ts}&amp;nbsp; , &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;store only for live game, if game finishes, persisted to db. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;open persisted switch,&amp;nbsp; persist every sevral seconds &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;how to partition:&amp;nbsp; redis cluster,&amp;nbsp; consistent hashing.&amp;nbsp; OR using increment game id, appending to more redis instances. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;4. &amp;nbsp; db:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;schema:&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="1420" width="1090" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="hHLxjckBWRFStJjJxvRh" name="upstart">
    <mxGraphModel dx="1038" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="P4siGihnM7z5hSICGsjr-1" value="&lt;div&gt;online go game&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;play go online: login, find match player, start game, place chess, time counter,&amp;nbsp; judge win/lose, get scores, leaderboard&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;resume game?&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;game reply?&lt;/div&gt;&lt;div&gt;NFR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;1 game 30min,&amp;nbsp;&amp;nbsp; availabitliy &amp;gt; consistency &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data durability&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;player exp:&amp;nbsp;&amp;nbsp; fast response&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;security:&amp;nbsp;&amp;nbsp; no ddos to server, no game cheaating,&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;capacity:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;DAU: 1m user/day,&amp;nbsp; place chess qps: 1m * 5 * 100 steps /day -&amp;gt; 5k qps.&amp;nbsp; : place 1 chess.&amp;nbsp;&amp;nbsp;&amp;nbsp; peak:&amp;nbsp; 20k qps.&amp;nbsp; other qps: start game, login, : should be very low. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data storage:&amp;nbsp;&amp;nbsp; 1m * 5 games -&amp;gt; 5m game * 10kB -&amp;gt; 50GB / day -&amp;gt; 15TB/year,&amp;nbsp; 2-3 db is quite enough.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;data property&amp;nbsp; most of are cold data, and might not need to be stored for long time, so can clean every 1 month.&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;network:&amp;nbsp;&amp;nbsp;&amp;nbsp; 5kqps -&amp;gt; 1kB per req -&amp;gt;&amp;nbsp; 5MBs -&amp;gt; 40Mbs &amp;nbsp;&amp;nbsp; easy. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;API:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;arch: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="30" y="40" width="770" height="30" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-2" target="P4siGihnM7z5hSICGsjr-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-2" target="P4siGihnM7z5hSICGsjr-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-2" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="70" y="450" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-30" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-3" target="P4siGihnM7z5hSICGsjr-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-3" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" parent="1" vertex="1">
          <mxGeometry x="70" y="620" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-4" target="P4siGihnM7z5hSICGsjr-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="1" source="P4siGihnM7z5hSICGsjr-4" target="P4siGihnM7z5hSICGsjr-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-4" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="180" y="500" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-5" value="user svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="310" y="410" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.167;entryY=0.967;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="P4siGihnM7z5hSICGsjr-6" target="P4siGihnM7z5hSICGsjr-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;entryX=0.383;entryY=0.967;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="P4siGihnM7z5hSICGsjr-6" target="P4siGihnM7z5hSICGsjr-11" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-17" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-6" target="P4siGihnM7z5hSICGsjr-8" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-24" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-6" target="P4siGihnM7z5hSICGsjr-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-6" value="game svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="570" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-31" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-7" target="P4siGihnM7z5hSICGsjr-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-7" value="push svc" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="195" y="620" width="70" height="80" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.333;entryY=0.917;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="P4siGihnM7z5hSICGsjr-8" target="P4siGihnM7z5hSICGsjr-9" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-8" value="in memory storage" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="530" y="660" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-9" value="db layer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="690" y="555" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-10" value="timer" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="490" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-11" value="rule engine" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="650" y="440" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-25" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;entryX=0.817;entryY=0.067;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="P4siGihnM7z5hSICGsjr-19" target="P4siGihnM7z5hSICGsjr-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-26" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-19" target="P4siGihnM7z5hSICGsjr-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-27" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.25;entryY=0;entryDx=0;entryDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-19" target="P4siGihnM7z5hSICGsjr-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-28" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=1;exitDx=0;exitDy=0;" parent="1" source="P4siGihnM7z5hSICGsjr-19" target="P4siGihnM7z5hSICGsjr-23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-19" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;" parent="1" vertex="1">
          <mxGeometry x="400" y="750" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-20" value="history" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="240" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-21" value="score" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="440" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-22" value="leaderboard" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="620" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="P4siGihnM7z5hSICGsjr-23" value="analysis" style="rounded=0;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="820" y="850" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="b_sVi-EikZUh4uA52T-h" name="upstart ">
    <mxGraphModel dx="1062" dy="556" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="7wYgEpcxCvOJzpMag7Ii-1" value="&lt;div&gt;online game &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;FR &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;login&lt;/div&gt;&lt;blockquote&gt;&lt;div&gt;find a match player&lt;/div&gt;&lt;div&gt;start a game&lt;/div&gt;&lt;div&gt;place chess&lt;/div&gt;&lt;div&gt;received actions from opponent&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;optional:&lt;/div&gt;&lt;div&gt;calc score&lt;/div&gt;&lt;div&gt;leaderboard&lt;/div&gt;&lt;div&gt;resume game when interrupted&lt;/div&gt;&lt;div&gt;play replay&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;NFR:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;avail &amp;gt; consistency&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;scale&amp;nbsp;  &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;data durability ? &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;user experience latency: not high&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;security: no cheating.&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;capacity:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;user flow:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;login -&amp;gt; find matcher -&amp;gt; start game -&amp;gt; place chess -&amp;gt; wait for other ppl to place -&amp;gt; place again --..--&amp;gt; win or lose -&amp;gt; calc scores. &lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt; -&amp;gt; if other&amp;nbsp; ppl exceed the time -&amp;gt; robot helps to place the chess, and change turn. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;if one dropped off:&amp;nbsp;&amp;nbsp; &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;api:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;login&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;place chess api: &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;get score api:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre&quot;&gt;	&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;arch:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="50" y="70" width="650" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-17" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-1" target="WMCqpl3Cgi7hsk11DNyX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-1" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="1">
          <mxGeometry x="80" y="760" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-18" style="edgeStyle=none;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-2" target="WMCqpl3Cgi7hsk11DNyX-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-2" value="Actor" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;" vertex="1" parent="1">
          <mxGeometry x="80" y="960" width="30" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-20" value="1login" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-3" target="WMCqpl3Cgi7hsk11DNyX-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-21" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-3" target="WMCqpl3Cgi7hsk11DNyX-22">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="830" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-46" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=1;exitDx=0;exitDy=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-3" target="WMCqpl3Cgi7hsk11DNyX-47">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="870" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-3" value="gw" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="250" y="760" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-19" value="user svc" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="330" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-24" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-22" target="WMCqpl3Cgi7hsk11DNyX-25">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-30" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-22" target="WMCqpl3Cgi7hsk11DNyX-31">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="630" y="980" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-34" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-22" target="WMCqpl3Cgi7hsk11DNyX-35">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="590" y="780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-36" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-22" target="WMCqpl3Cgi7hsk11DNyX-37">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="660" y="790" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-38" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0;exitDx=0;exitDy=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-22" target="WMCqpl3Cgi7hsk11DNyX-39">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="800" y="780" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-40" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-22" target="WMCqpl3Cgi7hsk11DNyX-41">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="510" y="1080" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-22" value="game svc" style="rounded=1;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="530" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-25" value="long conn svc" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="260" y="930" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-28" value="duplex" style="shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;strokeColor=default;entryX=0.033;entryY=0.133;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" target="WMCqpl3Cgi7hsk11DNyX-25">
          <mxGeometry width="100" height="100" relative="1" as="geometry">
            <mxPoint x="110" y="830" as="sourcePoint" />
            <mxPoint x="220" y="820" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-29" value="duplex" style="shape=flexArrow;endArrow=classic;startArrow=classic;html=1;rounded=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;strokeColor=default;entryX=0.033;entryY=0.133;entryDx=0;entryDy=0;entryPerimeter=0;exitX=1;exitY=0.3333333333333333;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-2">
          <mxGeometry width="100" height="100" relative="1" as="geometry">
            <mxPoint x="120" y="840" as="sourcePoint" />
            <mxPoint x="273.96000000000004" y="947.98" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-32" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-31" target="WMCqpl3Cgi7hsk11DNyX-33">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="780" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-31" value="redis" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="630" y="980" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-33" value="game db" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="780" y="850" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-35" value="timer svc" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="480" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-37" value="rule engine" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="630" y="730" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-39" value="robot engine" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="780" y="740" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-42" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.25;exitY=1;exitDx=0;exitDy=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-41" target="WMCqpl3Cgi7hsk11DNyX-43">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="420" y="1190" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-41" value="mq" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="450" y="1080" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-43" value="analysis" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="320" y="1190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-44" value="user history" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="470" y="1190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-45" value="game replay" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="620" y="1190" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-48" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.417;entryY=0.917;entryDx=0;entryDy=0;entryPerimeter=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-47" target="WMCqpl3Cgi7hsk11DNyX-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-49" style="edgeStyle=none;shape=connector;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.75;exitY=0;exitDx=0;exitDy=0;labelBackgroundColor=default;fontFamily=Helvetica;fontSize=11;fontColor=default;startArrow=none;startFill=0;endArrow=classic;strokeColor=default;" edge="1" parent="1" source="WMCqpl3Cgi7hsk11DNyX-47" target="WMCqpl3Cgi7hsk11DNyX-50">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="490" y="700" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-47" value="matcher svc" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="330" y="840" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-50" value="user score svc" style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="480" y="630" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-51" value="cdn: static, game installer, game patcher, etc.... " style="rounded=0;whiteSpace=wrap;html=1;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="60" y="1110" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="WMCqpl3Cgi7hsk11DNyX-52" value="&lt;div&gt;game id: game status {&lt;/div&gt;&lt;blockquote&gt;&lt;blockquote&gt;&lt;div&gt;game cur state,&lt;/div&gt;&lt;div&gt;cur player&lt;/div&gt;&lt;div&gt;status: not started, running, finished&lt;/div&gt;&lt;div&gt;winner:&lt;/div&gt;&lt;div&gt;players. &lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;}&lt;/div&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontFamily=Helvetica;fontSize=11;fontColor=default;" vertex="1" parent="1">
          <mxGeometry x="790" y="995" width="340" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
